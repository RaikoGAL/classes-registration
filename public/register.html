<!doctype html>
<html lang="he">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>טופס הרשמה לחוג</title>
  <style>
    html{direction:rtl}body{margin:0;padding:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans Hebrew","Rubik",sans-serif;background:#0b0d12;color:#e6e8ee}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    .header{display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
    .logo{font-weight:800;letter-spacing:.3px}
    .actions a,.btn{display:inline-block;padding:12px 18px;border-radius:14px;border:1px solid #2a3246;background:#121826;color:#e6e8ee;font-size:16px}
    .card{background:linear-gradient(180deg,#0f1422,#0b0f1a);border:1px solid #253048;border-radius:18px;padding:16px;display:flex;flex-direction:column}
    .sessions{margin:8px 0;display:flex;flex-wrap:wrap;gap:6px}
    .form{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}.form .full{grid-column:1/-1}
    .footer{margin-top:32px;text-align:center;color:#334155}
    @media (max-width:540px){.container{padding:16px}.form{grid-template-columns:1fr}.btn.primary{width:100%}}
  </style>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="page-register light">
  <div class="container">
    <div class="header">
      <div class="logo"><a href="index.html">מועדון השחמט ראשון לציון</a></div>
      <div class="actions"><a href="index.html" class="back-btn" aria-label="חזרה">חזרה</a></div>
    </div>

    <h1 id="classTitle">שם החוג</h1>
    <div id="classMeta" class="subtle">רמה • מאמן/ת</div>

    <div class="card" style="margin-top:14px;">
      <div>
        <label>בחירת ימי מפגש
          <select id="meetingOption">
            <option value="both">שני המפגשים (שני+רביעי)</option>
            <option value="day1">יום שני</option>
            <option value="day2">יום רביעי</option>
          </select>
        </label>
        <div id="sessionsList" class="sessions"></div>
      </div>

      <h3 style="margin-top:10px;">פרטי המשתתף/ת</h3>
      <form id="regForm" class="form">
        <input type="hidden" id="groupKey" value="">
        <div><label>שם פרטי<input id="firstName" required></label></div>
        <div><label>שם משפחה<input id="lastName" required></label></div>
        <div><label>תאריך לידה<input id="birthDate" type="date"></label></div>
        <div><label>שם הורה (אם רלוונטי)<input id="parentName"></label></div>
        <div><label>טלפון<input id="phone" required></label></div>
        <div><label>אימייל<input id="email" type="email"></label></div>
        <div class="full"><label>הערות<textarea id="notes" rows="3" placeholder="מידע רפואי/בקשות"></textarea></label></div>

        <!-- סכום + כפתור בצד שמאל (ללא שורת המחיר העליונה) -->
        <div class="full payrow">
          <div><span>סכום לתשלום:</span> <span class="amount" id="paybarAmount">₪0</span></div>
          <button type="button" class="btn primary small" onclick="return saveThenPay(event)">מעבר לתשלום</button>
        </div>
      </form>
    </div>

    <div class="footer">ההפניה היא ישירות ל-Meshulam לקישור המתאים.</div>
  </div>

  <script src="script.js"></script>
  <script src="payments.js"></script>

  <script>
    // שמירת groupId מה-URL
    (function () {
      var sp = new URL(location.href).searchParams;
      var g = sp.get('group') || sp.get('groupId') || '';
      if (g) { document.body.dataset.group = g; var h=document.getElementById('groupKey'); if(h) h.value=g; }
    })();

    // ברירת מחדל "שני המפגשים" אם יש 2 מפגשים; עדכון סכום; רענון כשחוזרים אחורה
    (function(){
      const PRICE_ONE=235, PRICE_BOTH=355;
      const sel=document.getElementById('meetingOption');
      const pay=document.getElementById('paybarAmount');
      const sessions=document.getElementById('sessionsList');

      function amount(v){ return v==='both'?PRICE_BOTH:PRICE_ONE; }
      function update(){ pay.textContent='₪'+amount(sel.value); }
      function chooseDefault(){
        const cnt=sessions?sessions.querySelectorAll('.session').length:0;
        sel.value = (cnt>=2)?'both':'day1';
        update();
      }
      window.addEventListener('pageshow',e=>{ if(e.persisted) location.reload(); });
      if(sel){
        const mo=new MutationObserver(chooseDefault);
        if(sessions) mo.observe(sessions,{childList:true,subtree:true});
        chooseDefault();
        sel.addEventListener('change',update);
      }
    })();
  </script>
</body>
</html>
